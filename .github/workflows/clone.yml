name: deploy to a server on push

  on:
    push:
      branches:
        - main

  env:
    BRANCH: ${{ github.ref }}

jobs:
  release:
      runs-on: ubuntu-latest

      steps:
        - name: Clone web module
          uses: actions/checkout@v2

        - name: Get release version
          run: |
            echo "RELEASE_VERSION=${BRANCH##*/}" >> $GITHUB_ENV
        - name: Clone web module
          uses: actions/checkout@v2
          with:
            fetch-depth: 0
            repository: testes/back-act
            path: 'back-act'
            token: ${{ secrets.G_ACCESS_TOKEN }}

        - name: Get front module hash
          run: |
            pwd
            cd back-act
            echo "FRONT_GIT_HASH=$(git rev-parse --short=7 HEAD)" >> $GITHUB_ENV
            cd ..
       
        - name: List files in the repository
          run: |
            ls ${{ github.workspace }}/back-act

