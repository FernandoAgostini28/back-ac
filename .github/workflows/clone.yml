name: deploy to a server on push

on:
  push:
    branches:
      - main

env:
  BRANCH: ${{ github.ref }}

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    steps:

      - name: Get latest code
        uses: actions/checkout@v2

        
      

      - name: Clone web module
        uses: actions/checkout@v2
      - name: Get release version
        run: |
          echo "RELEASE_VERSION=${BRANCH##*/}" >> $GITHUB_ENV
      - name: Clone web module
        uses: actions/checkout@v2
        with:
          etch-depth: 0
          repository: FernandoAgostini28/front-ac
          path: 'front-act'
          token: ${{ secrets.G_ACCESS_TOKEN }}

      - name: Get front module hash
        run: |
          pwd
          cd front-act
          echo "FRONT_GIT_HASH=$(git rev-parse --short=7 HEAD)" >> $GITHUB_ENV
          cd ..

      # - name: Build Project
      #   run: |
      #     npm install
      #     npm run build 

      # - name: Upload artifacts to be used in next job
      #   if: success()
      #   uses: actions/upload-artifact@v1
      #   with:
      #     name: dist
      #     path: dist

      - name: list arquivos
        run: |
          cd ..
          mkdir back-copi
          cp -r back-copi ${{ github.workspace }} 
          ls -a
          cd back-copi
          ls -a
          cd ..
          
        # mv front-act ${{ github.workspace }}
        # cd ..
          ls -a

      - name: Build front
        run: |
          cd front-act
          ls  -a
      # npm ci
      # npm run build --base-href /public/

        # - name: Copy ionic output to web module
        #   run: |
        #     cd back-act
        #     mkdir ../back-act/dist/public
        #     cp -r www/* ../back-act/dist/public
       
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
          ls ${{ github.workspace }}/front-act

