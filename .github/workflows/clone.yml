name: deploy to a server on push

on:
  push:
    branches:
      - main

env:
  BRANCH: ${{ github.ref }}

jobs:
  build:
      runs-on: ubuntu-latest

      steps:
        - name: buid back
          uses: actions/checkout@v2

        - name: Use Node.js 14
          uses: actions/setup-node@v2
          with:
            node-version: '14.17.6'

        # - name: Build back
        #   run: |
        #     mkdir back-end
        #     cd back-end
        #     npm ci
        #     npm run build 
        #     cd ..
     
        # - name: Clone web module
        #   uses: actions/checkout@v2

        - name: Get release version
          run: |
            echo "RELEASE_VERSION=${BRANCH##*/}" >> $GITHUB_ENV
        - name: Clone web module
          uses: actions/checkout@v2
          with:
            fetch-depth: 0
            repository: FernandoAgostini28/front-ac
            path: 'front-act'
            token: ${{ secrets.G_ACCESS_TOKEN }}

        - name: Get front module hash
          run: |
            pwd
            cd front-act
            echo "FRONT_GIT_HASH=$(git rev-parse --short=7 HEAD)" >> $GITHUB_ENV
            cd ..

        - name: Build back
          run: |
            ls -a
            npm ci
            npm run build 

        # - name: Build front
        #   run: |
        #     cd back-act
        #     npm ci
        #     npm run build --base-href /public/

        # - name: Copy ionic output to web module
        #   run: |
        #     cd back-act
        #     mkdir ../back-act/dist/public
        #     cp -r www/* ../back-act/dist/public
       
        - name: List files in the repository
          run: |
            ls ${{ github.workspace }}

